<!DOCTYPE html>
<html>
  <head>
    <style>
      nav a {
        display: inline-block;
        padding: 0.5rem;
        cursor: pointer;
      }
      nav a.active {
        background-color: greenyellow;
        cursor: default;
      }
    </style>
    <script src="/lib/mithril.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <script>
      var store = [
        [11,12],
        [21,22,23],
        [31,32,33,34]
      ];

      var app = {
        controller: function(){
          var pageNo = 1;
          if (window.location.hash.length > 1) {
            pageNo = window.location.hash.substring(1);
          }

          var self = this;

          this.pager = {
            pageNo: pageNo,
            pageCount: store.length,
            handler: self.loadPage
          };

          this.loadPage = function(i) {
            self.items = store[i-1];
            self.pager.pageNo = i;
            window.location.hash = "#" + i;
          }

          this.loadPage(pageNo);
        },
        view: function(ctrl){
          var body = ctrl.items.map(function(item){
            return m("div", {
                //key: item            // pager works, if comment out this line
              }, "text " + item);
          });

          if (ctrl.pager.pageCount > 1) {
            var pager = m.component(Pager, {
              current: ctrl.pager.pageNo,
              count: ctrl.pager.pageCount,
              handler: ctrl.loadPage
            });
            body = [pager, body, pager];
          }

          return m("div", body);
        }

      };

      var Pager = {
        controller: function(data) {
          this.goToPage = function(i) {
            return function(ev){
              data.handler(i);
            };
          }
        },
        view: function(ctrl, data) {
          var links = [];
          for(var i = 1; i <= data.count; i++) {
            links.push(m("a", i == data.current ? {"class":"active"} : {onclick: ctrl.goToPage(i)}, i));
          }
          return m("nav", links);
        }
      };

      m.mount(document.getElementById("app"), app);
    </script>
  </body>
</html>
