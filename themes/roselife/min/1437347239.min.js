(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}}(function(f){var a=/\+/g;function d(j){return b.raw?j:encodeURIComponent(j)}function g(j){return b.raw?j:decodeURIComponent(j)}function h(j){return d(b.json?JSON.stringify(j):String(j))}function c(j){if(j.indexOf('"')===0){j=j.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{j=decodeURIComponent(j.replace(a," "));return b.json?JSON.parse(j):j}catch(k){}}function e(k,j){var l=b.raw?k:c(k);return f.isFunction(j)?j(l):l}var b=f.cookie=function(q,p,v){if(arguments.length>1&&!f.isFunction(p)){v=f.extend({},b.defaults,v);if(typeof v.expires==="number"){var r=v.expires,u=v.expires=new Date();u.setTime(+u+r*86400000)}return(document.cookie=[d(q),"=",h(p),v.expires?"; expires="+v.expires.toUTCString():"",v.path?"; path="+v.path:"",v.domain?"; domain="+v.domain:"",v.secure?"; secure":""].join(""))}var w=q?undefined:{};var s=document.cookie?document.cookie.split("; "):[];for(var o=0,m=s.length;o<m;o++){var n=s[o].split("=");var j=g(n.shift());var k=n.join("=");if(q&&q===j){w=e(k,p);break}if(!q&&(k=e(k))!==undefined){w[j]=k}}return w};b.defaults={};f.removeCookie=function(k,j){if(f.cookie(k)===undefined){return false}f.cookie(k,"",f.extend({},j,{expires:-1}));return !f.cookie(k)}}));(function(a){a.fn.imageSlider=function(l){var e=a.extend({fadeTime:1000,switchTime:5000},l);var j=new Array();a("ul li",this).each(function(){j.push({img:a(this).attr("data-img"),title:a(this).html(),uri:a(this).attr("data-href")})});if(j.length>0){var f=j.length;var g=0;var b=a(this);var d=a("<a></a>").prependTo(b);var k=a("<span></span>").prependTo(d);var c=function(){b.css("background-image","url('"+j[g].img+"')");g=(g!=(f-1)?g+1:0);d.fadeOut(e.fadeTime,function(){d.css("background-image","url('"+j[g].img+"')");d.fadeIn(e.fadeTime);d.attr("href",j[g].uri);k.text(j[g].title)})};var h=setInterval(c,e.switchTime);d.css("background-image","url('"+j[g].img+"')");d.attr("href",j[g].uri);k.text(j[g].title)}return this}}(jQuery));
(function(a){a.fn.hoverIntent=function(n,d,h){var k={interval:100,sensitivity:6,timeout:0};if(typeof n==="object"){k=a.extend(k,n)}else{if(a.isFunction(d)){k=a.extend(k,{over:n,out:d,selector:h})}else{k=a.extend(k,{over:n,out:n,selector:d})}}var m,l,g,f;var e=function(o){m=o.pageX;l=o.pageY};var c=function(p,o){o.hoverIntent_t=clearTimeout(o.hoverIntent_t);if(Math.sqrt((g-m)*(g-m)+(f-l)*(f-l))<k.sensitivity){a(o).off("mousemove.hoverIntent",e);o.hoverIntent_s=true;return k.over.apply(o,[p])}else{g=m;f=l;o.hoverIntent_t=setTimeout(function(){c(p,o)},k.interval)}};var j=function(p,o){o.hoverIntent_t=clearTimeout(o.hoverIntent_t);o.hoverIntent_s=false;return k.out.apply(o,[p])};var b=function(q){var p=a.extend({},q);var o=this;if(o.hoverIntent_t){o.hoverIntent_t=clearTimeout(o.hoverIntent_t)}if(q.type==="mouseenter"){g=p.pageX;f=p.pageY;a(o).on("mousemove.hoverIntent",e);if(!o.hoverIntent_s){o.hoverIntent_t=setTimeout(function(){c(p,o)},k.interval)}}else{a(o).off("mousemove.hoverIntent",e);if(o.hoverIntent_s){o.hoverIntent_t=setTimeout(function(){j(p,o)},k.timeout)}}};return this.on({"mouseenter.hoverIntent":b,"mouseleave.hoverIntent":b},k.selector)}})(jQuery);(function(b){var a=(function(){var p={bcClass:"sf-breadcrumb",menuClass:"sf-js-enabled",anchorClass:"sf-with-ul",menuArrowClass:"sf-arrows"},e=(function(){var c=/iPhone|iPad|iPod/i.test(navigator.userAgent);if(c){b(window).load(function(){b("body").children().on("click",b.noop)})}return c})(),k=(function(){var c=document.documentElement.style;return("behavior" in c&&"fill" in c&&/iemobile/i.test(navigator.userAgent))})(),m=function(s,t){var c=p.menuClass;if(t.cssArrows){c+=" "+p.menuArrowClass}s.toggleClass(c)},r=function(c,s){return c.find("li."+s.pathClass).slice(0,s.pathLevels).addClass(s.hoverClass+" "+p.bcClass).filter(function(){return(b(this).children(s.popUpSelector).hide().show().length)}).removeClass(s.pathClass)},n=function(c){c.children("a").toggleClass(p.anchorClass)},f=function(c){var s=c.css("ms-touch-action");s=(s==="pan-y")?"auto":"pan-y";c.css("ms-touch-action",s)},j=function(t,u){var c="li:has("+u.popUpSelector+")";if(b.fn.hoverIntent&&!u.disableHI){t.hoverIntent(l,g,c)}else{t.on("mouseenter.superfish",c,l).on("mouseleave.superfish",c,g)}var s="MSPointerDown.superfish";if(!e){s+=" touchend.superfish"}if(k){s+=" mousedown.superfish"}t.on("focusin.superfish","li",l).on("focusout.superfish","li",g).on(s,"a",u,h)},h=function(t){var s=b(this),c=s.siblings(t.data.popUpSelector);if(c.length>0&&c.is(":hidden")){s.one("click.superfish",false);if(t.type==="MSPointerDown"){s.trigger("focus")}else{b.proxy(l,s.parent("li"))()}}},l=function(){var c=b(this),s=o(c);clearTimeout(s.sfTimer);c.siblings().superfish("hide").end().superfish("show")},g=function(){var c=b(this),s=o(c);if(e){b.proxy(q,c,s)()}else{clearTimeout(s.sfTimer);s.sfTimer=setTimeout(b.proxy(q,c,s),s.delay)}},q=function(c){c.retainPath=(b.inArray(this[0],c.$path)>-1);this.superfish("hide");if(!this.parents("."+c.hoverClass).length){c.onIdle.call(d(this));if(c.$path.length){b.proxy(l,c.$path)()}}},d=function(c){return c.closest("."+p.menuClass)},o=function(c){return d(c).data("sf-options")};return{hide:function(s){if(this.length){var v=this,w=o(v);if(!w){return this}var t=(w.retainPath===true)?w.$path:"",c=v.find("li."+w.hoverClass).add(this).not(t).removeClass(w.hoverClass).children(w.popUpSelector),u=w.speedOut;if(s){c.show();u=0}w.retainPath=false;w.onBeforeHide.call(c);c.stop(true,true).animate(w.animationOut,u,function(){var x=b(this);w.onHide.call(x)})}return this},show:function(){var t=o(this);if(!t){return this}var s=this.addClass(t.hoverClass),c=s.children(t.popUpSelector);t.onBeforeShow.call(c);c.stop(true,true).animate(t.animation,t.speed,function(){t.onShow.call(c)});return this},destroy:function(){return this.each(function(){var s=b(this),t=s.data("sf-options"),c;if(!t){return false}c=s.find(t.popUpSelector).parent("li");clearTimeout(t.sfTimer);m(s,t);n(c);f(s);s.off(".superfish").off(".hoverIntent");c.children(t.popUpSelector).attr("style",function(u,v){return v.replace(/display[^;]+;?/g,"")});t.$path.removeClass(t.hoverClass+" "+p.bcClass).addClass(t.pathClass);s.find("."+t.hoverClass).removeClass(t.hoverClass);t.onDestroy.call(s);s.removeData("sf-options")})},init:function(c){return this.each(function(){var t=b(this);if(t.data("sf-options")){return false}var u=b.extend({},b.fn.superfish.defaults,c),s=t.find(u.popUpSelector).parent("li");u.$path=r(t,u);t.data("sf-options",u);m(t,u);n(s);f(t);j(t,u);s.not("."+p.bcClass).superfish("hide",true);u.onInit.call(this)})}}})();b.fn.superfish=function(d,c){if(a[d]){return a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments)}else{return b.error("Method "+d+" does not exist on jQuery.fn.superfish")}}};b.fn.superfish.defaults={popUpSelector:"ul",hoverClass:"sfHover",pathClass:"overrideThisToUse",pathLevels:1,delay:800,animation:{opacity:"show"},animationOut:{opacity:"hide"},speed:"normal",speedOut:"fast",cssArrows:true,disableHI:false,onInit:b.noop,onBeforeShow:b.noop,onShow:b.noop,onBeforeHide:b.noop,onHide:b.noop,onIdle:b.noop,onDestroy:b.noop}})(jQuery);(function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=="string"){method=settings;params=extraSettings}options={id:"",nameSpace:"",root:"",previewHandler:false,previewInWindow:"",previewInElement:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:false,previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}var uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};var matched=uaMatch(navigator.userAgent);var browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else{if(browser.webkit){browser.safari=true}}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}return}function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp)});footer.append(resizeHandle)}$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed);$$.bind("insertion.markItUp",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.bind("focus.markItUp",function(){$.markItUp.focused=this});if(options.previewInElement){refreshPreview()}}function stripHTML(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(stripHTML(button.name)||"")+" [Ctrl+"+button.key+"]":(stripHTML(button.name)||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return false}).bind("click.markItUp",function(e){e.preventDefault()}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){if(button.call){eval(button.call)()}setTimeout(function(){markup(button)},1);return false}).bind("mouseenter.markItUp",function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){var openWith=prepare(clicked.openWith);var placeHolder=prepare(clicked.placeHolder);var replaceWith=prepare(clicked.replaceWith);var closeWith=prepare(clicked.closeWith);var openBlockWith=prepare(clicked.openBlockWith);var closeBlockWith=prepare(clicked.closeBlockWith);var multiline=clicked.multiline;if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{string=string||selection;var lines=[string],blocks=[];if(multiline===true){lines=string.split(/\r?\n/)}for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/)){blocks.push(openWith+line.replace(/ *$/g,"")+closeWith+trailingSpaces)}else{blocks.push(openWith+line+closeWith)}}block=blocks.join("\n")}}block=openBlockWith+block+closeBlockWith;return{block:block,openBlockWith:openBlockWith,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith,closeBlockWith:closeBlockWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if((ctrlKey===true&&shiftKey===true)){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+((browser.opera)?n-1:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openBlockWith.length+string.openWith.length;len=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if(browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if(browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}}function set(start,len){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if(browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){return;if(typeof options.previewHandler==="function"){previewWindow=true}else{if(options.previewInElement){previewWindow=$(options.previewInElement)}else{if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow);$(window).unload(function(){previewWindow.close()})}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}else{previewWindow.close()}previewWindow=iFrame=false}}}}if(!options.previewAutoRefresh){refreshPreview()}if(options.previewInWindow){previewWindow.focus()}}function refreshPreview(){renderPreview()}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==="function"){options.previewHandler($$.val())}else{if(options.previewParser&&typeof options.previewParser==="function"){var data=options.previewParser($$.val());writeInPreview(localize(data,1))}else{if(options.previewParserPath!==""){$.ajax({type:"POST",dataType:"text",global:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1))}})}else{if(!template){$.ajax({url:options.previewTemplatePath,dataType:"text",global:false,success:function(data){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()))}})}}}}return false}function writeInPreview(data){if(options.previewInElement){$(options.previewInElement).html(data)}else{if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(data);previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}}}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?(e.ctrlKey||e.metaKey):false;if(e.type==="keydown"){if(ctrlKey===true){li=$('a[accesskey="'+((e.keyCode==13)?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li");if(li.length!==0){ctrlKey=false;setTimeout(function(){li.triggerHandler("mouseup")},1);return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$);$$.data("markItUp",null)}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);var myBBCodeSettings={markupSet:[{name:"Bold",key:"B",openWith:"[b]",closeWith:"[/b]"},{name:"Italic",key:"I",openWith:"[i]",closeWith:"[/i]"},{name:"Underline",key:"U",openWith:"[u]",closeWith:"[/u]"},{name:"Strikethrough",openWith:"[s]",closeWith:"[/s]"},{name:"Font Size",openWith:"[size=[![Font size]!]]",closeWith:"[/size]",dropMenu:[{name:'<span style="line-height:16px;font-size:120%">Big</span>',openWith:"[size=120%]",closeWith:"[/size]"},{name:'<span style="line-height:16px;font-size:100%">Normal</span>',openWith:"[size=100%]",closeWith:"[/size]"},{name:'<span style="line-height:16px;font-size:80%">Small</span>',openWith:"[size=80%]",closeWith:"[/size]"}]},{name:"Font Color",className:"colors",openWith:"[color=[![Font Color]!]]",closeWith:"[/color]",dropMenu:[{name:"Yellow",openWith:"[color=yellow]",closeWith:"[/color]",className:"col1-1"},{name:"Orange",openWith:"[color=orange]",closeWith:"[/color]",className:"col1-2"},{name:"Red",openWith:"[color=red]",closeWith:"[/color]",className:"col1-3"},{name:"Blue",openWith:"[color=blue]",closeWith:"[/color]",className:"col2-1"},{name:"Purple",openWith:"[color=purple]",closeWith:"[/color]",className:"col2-2"},{name:"Green",openWith:"[color=green]",closeWith:"[/color]",className:"col2-3"},{name:"White",openWith:"[color=white]",closeWith:"[/color]",className:"col3-1"},{name:"Gray",openWith:"[color=gray]",closeWith:"[/color]",className:"col3-2"},{name:"Black",openWith:"[color=black]",closeWith:"[/color]",className:"col3-3"}]},{name:"Font Background Color",className:"bgcolors",openWith:"[bgcolor=[![Font Background Color]!]]",closeWith:"[/bgcolor]",dropMenu:[{name:"Yellow",openWith:"[bgcolor=yellow]",closeWith:"[/bgcolor]",className:"col1-1"},{name:"Orange",openWith:"[bgcolor=orange]",closeWith:"[/bgcolor]",className:"col1-2"},{name:"Red",openWith:"[bgcolor=red]",closeWith:"[/bgcolor]",className:"col1-3"},{name:"Blue",openWith:"[bgcolor=blue]",closeWith:"[/bgcolor]",className:"col2-1"},{name:"Purple",openWith:"[bgcolor=purple]",closeWith:"[/bgcolor]",className:"col2-2"},{name:"Green",openWith:"[bgcolor=green]",closeWith:"[/bgcolor]",className:"col2-3"},{name:"White",openWith:"[bgcolor=white]",closeWith:"[/bgcolor]",className:"col3-1"},{name:"Gray",openWith:"[bgcolor=gray]",closeWith:"[/bgcolor]",className:"col3-2"},{name:"Black",openWith:"[bgcolor=black]",closeWith:"[/bgcolor]",className:"col3-3"}]},{separator:" "},{name:"Picture",key:"P",replaceWith:"[img][![Image url]!][/img]"},{name:"Link",key:"L",openWith:"[url=[![Link url]!]]",closeWith:"[/url]",placeHolder:"Your text to link here..."},{name:"YouTube Video",openWith:"[youtube]",closeWith:"[/youtube]"},{separator:" "},{name:"Bulleted list",openWith:"[list]\n",closeWith:"\n[/list]"},{name:"Numeric list",openWith:"[list=[![Starting number]!]]\n",closeWith:"\n[/list]"},{name:"List item",openWith:"[*] "},{separator:" "},{name:"Quotes",openWith:"[quote]",closeWith:"[/quote]"},{name:"Code",openWith:"[code]",closeWith:"[/code]"},{separator:" "},{name:"Clean",replaceWith:function(a){return a.selection.replace(/\[(.*?)\]/g,"")}},]};(function(b){var a=0;b.fn.upload=function(f,j,m){var k=this,e,l="jquery_upload"+ ++a,g=b('<iframe name="'+l+'" style="position:absolute;top:-9999px" />').appendTo("body"),h='<form target="'+l+'" method="post" action="'+f+'" enctype="multipart/form-data" accept-charset="UTF-8"></form>';if(b.isFunction(j)){m=j;j={}}h=k.wrap(h).parent("form");e=d(j);e=e?b(e).appendTo(h):null;h.submit(function(){g.on("load",function(){var n;try{n=b.parseJSON(g.contents().text())}catch(o){alert("上传文件失败，请换用其他浏览器上传文件。错误信息:"+o.message);submitBug({msg:o.message,data:g.contents().text()})}if(e){e.remove()}k.unwrap();g.remove();if(m){m.call(self,n)}})}).submit()};function d(e){return b.map(c(e),function(f){return'<input type="hidden" name="'+f.name+'" value="'+f.value+'"/>'}).join("")}function c(e){if(b.isArray(e)){return e}var g=[];function f(h,j){g.push({name:h,value:j})}if(typeof e==="object"){b.each(e,function(h){if(b.isArray(this)){b.each(this,function(){f(h,this)})}else{f(h,b.isFunction(this)?this():this)}})}else{if(typeof e==="string"){b.each(e.split("&"),function(){var h=b.map(this.split("="),function(j){return decodeURIComponent(j.replace(/\+/g," "))});f(h[0],h[1])})}}return g}})(jQuery);function submitBug(a){$.post("/api/bug?action=post",a)}var session={set:function(a,b){if(b==null){sessionStorage.removeItem(a)}else{sessionStorage.setItem(a,JSON.stringify(b))}},get:function(a){var b=sessionStorage.getItem(a);if(b==null){return null}else{return JSON.parse(b)}},remove:function(a){sessionStorage.removeItem(a)},clear:function(){sessionStorage.clear()}};var cache={set:function(a,b){if(b==null){localStorage.removeItem(a)}else{localStorage.setItem(a,JSON.stringify(b))}},get:function(a){var b=localStorage.getItem(a);if(b==null){return null}else{return JSON.parse(b)}},remove:function(a){localStorage.removeItem(a)},clear:function(){localStorage.clear()}};var validateResponse=function(a){if(!a){alert("服务器没有响应");return false}else{if(a.error){alert(a.error);return false}}return true};$(document).ready(function(){var a=function(d){if(d.sessionID){cache.set("sessionID",d.sessionID);cache.set("uid",d.uid);if(d.uid>0){cache.set("username",d.username);cache.set("role",d.role)}if(d.pm>0){session.set("pm",d.pm)}return d.uid}else{if(d.error){alert(d.error)}else{alert("对话加载失败")}return 0}};var b=function(k){$(".image_slider").imageSlider();$(".ajax_load").each(function(){var y=$(this);var z=y.attr("data-ajax");if(z){$.getJSON(z,function(A){for(var B in A){$(".ajax_"+B,y).html(A[B])}})}});$("nav#page_navbar ul.sf-menu").superfish();var w=false,s=$("div.nav_mobile > a.icon-menu"),t=$("nav#page_navbar");var u=function(){if(t.css("display")==="none"){if(!w){s.on("click",function(y){y.preventDefault();t.toggleClass("hidden")});w=true}}else{if(w){s.off("click");w=false}if(!t.hasClass("hidden")){t.addClass("hidden")}}};u();$(window).resize(u);$("div.nav_mobile a.icon-left-big").click(function(y){y.preventDefault();window.history.back()});$("div.nav_mobile a.icon-right-big").click(function(y){y.preventDefault();window.history.forward()});$("div.nav_mobile a.icon-cw").click(function(y){y.preventDefault();location.reload()});var x=function(y){var z=new Array();$("th",y).each(function(){z.push(this.innerHTML)});if(z.length>0){$("tbody tr",y).each(function(){var A=$("td",this);for(i=0;i<A.length;i++){$(A.get(i)).attr("data-header",z[i])}})}};$("table").each(function(){x(this)});var o=function(){$(".v_guest").show();$('[class*="v_user"]').remove()};var e=function(){$(".v_guest").remove();$(".v_user").show();$('[class*="v_user_"]').hide();$(".v_user_"+k).show();var B=cache.get("role");if(B&&B instanceof Array){for(var D=0;D<B.length;++D){$(".v_user_"+B[D]).show()}}var C=cache.get("username");if(C){$("#username").text(C)}var y=cache.get("pmCheckTime");if(!y||Date.now()>y+300000){$.get("/api/message/new",function(J){if(J.count&&J.count>0){$("a#pm").append('<span style="color:red;"> ('+J.count+")<span>")}});cache.set("pmCheckTime",Date.now())}var E=$("#bbcode_editor");if(E.length){var H=$("#bbcode_editor textarea"),I=$("#bbcode_editor .node_title"),G=$("#file_list"),F=$("tbody",G);H.markItUp(myBBCodeSettings);$("button.delete").click(function(K){var J=confirm("此操作不可恢复，您确认要删除该内容吗？");if(J){window.location=$(this).attr("data-action")}});$("button.reply").click(function(J){E.attr("action",$(this).attr("data-action"));I.hide();G.hide();F.children().remove();H.val("").focus();window.scrollTo(0,E.offset().top)});$("button.quote").click(function(L){E.attr("action",$(this).attr("data-action"));I.hide();G.hide();F.children().remove();var K=$($(this).attr("data-raw"));var J=K.find("pre.username").html(),M='[quote="'+J+'"]'+K.find("pre.body").html()+"[/quote]\n";H.val("").focus();$.markItUp({replaceWith:M});window.scrollTo(0,E.offset().top)});var A=function(N){for(var L=0;L<N.length;L++){var P=N[L].fid?N[L].fid:N[L].path,M=new Array("jpeg","gif","png"),K=N[L].path.split(".").pop(),J;if(M.indexOf(K)>=0){J="[img]"+N[L].path+"[/img]"}else{J='[file="'+N[L].path+'"]'+N[L].name+"[/file]"}var O='<tr><td><input type="text" name="files['+P+'][name]" value="'+N[L].name+'"><input type="hidden" name="files['+P+'][path]" value="'+N[L].path+'"></td><td>'+J+'</td><td><button type="button" class="file_delete">删除</button></td></tr>';F.append(O)}x(G)};$("button.edit").click(function(M){var L=$(this).attr("data-action");E.attr("action",L);if(L.split("/")[1]=="node"){I.show()}else{I.hide()}F.children().remove();var K=$($(this).attr("data-raw"));var J=$.parseJSON(K.find("pre.files").html());if(J instanceof Array&&J.length>0){A(J);G.show()}else{G.hide()}H.val($($(this).attr("data-raw")).find("pre.body").html()).focus();window.scrollTo(0,E.offset().top)});$("button.create_node").click(function(J){E.attr("action",$(this).attr("data-action"));I.show();G.hide();F.children().remove();H.val("");$("input",I).val("").focus();window.scrollTo(0,E.offset().top)});$("#file_upload").click(function(N){var L=$("#file_select");if(L.val().length>0){var J=0,M=L.get(0).files;if(M){if(M.length>5){alert("一次只能上传 5 张图片");return}for(D=0;D<M.length;D++){J+=M[D].size;if(J>5242880){alert("一次只能上传图片的总大小为 5 MB，您只能选择前 "+D+" 张图片上传");return}}}var K=$(this);K.prepend('<span class="spinner"></span>');K.prop("disabled",true);L.upload("/api/file?action=post",function(P){L.val("");K.prop("disabled",false);K.find("span.spinner").remove();if(P){try{if(P.error&&P.error.length>0){var R="";if(Object.prototype.toString.call(P.error)==="[object Array]"){for(var O=0;O<P.error.length;O++){R=R+P.error[O].name+" : "+P.error[O].error+"\n"}}else{R=P.error}alert(R)}if(P.saved&&P.saved.length>0){A(P.saved);G.show()}}catch(Q){alert("上传文件失败，请换用其他浏览器上传文件。错误信息:"+Q.message);submitBug({msg:Q.message,data:P})}}})}});$("#file_clear").click(function(){$("#file_select").val("")});G.on("click",".file_delete",function(K){var L=this.parentNode.parentNode;var J=L.parentNode.parentNode;J.deleteRow(L.rowIndex);if(J.rows.length<=1){G.hide()}});$("#bbcode_editor button:submit").click(function(J){if($("#file_select").val()){alert("请先上传或清空选中的文件");J.preventDefault()}});$("button.bookmark").click(function(){var J=$(this);$.get(J.attr("data-action"),function(){alert("帖子成功加入到您的收藏夹中！")})})}var z=[];$("button.edit_bookmark").click(function(){var J=$(this);if(J.text()=="编辑"){J.text("保存");$("button.delete_bookmark").show()}else{if(z){J.prop("disabled",true);$.get("/api/bookmark/"+z.join()+"?action=delete",function(){J.text("编辑");$("button.delete_bookmark").hide();z=[];J.prop("disabled",false)})}else{J.text("编辑");$("button.delete_bookmark").hide()}}});$("button.delete_bookmark").click(function(){button=$(this);z.push(button.attr("data-nid"));button.parent().remove()})};var p=$(window),j=$("#goTop"),l=false;var m=function(){l=true;j.stop().animate({bottom:"50px"},300)};var q=function(){l=false;j.stop().animate({bottom:"-100px"},300)};var f=function(){if(p.scrollTop()>300){if(!l){m()}}else{if(l){q()}}};f();p.scroll(f);j.click(function(y){$("html, body").stop().animate({scrollTop:0},300,q);y.preventDefault()});var g={login:{html:'<form accept-charset="UTF-8" autocomplete="on" method="post"><fieldset><label class="label">用户名</label><input name="username" type="text" required autofocus></fieldset><fieldset><label class="label">密码</label><input name="password" type="password" required></fieldset><fieldset><button type="submit">登录</button></fieldset></form>',handler:"/api/authentication",success:function(y){if(validateResponse(y)){a(y);return"<script>location.reload();<\/script>"}}},changePassword:{html:'<form accept-charset="UTF-8" autocomplete="off" method="post"><fieldset><label class="label oldpassword">旧密码</label><input name="password_old" type="password" required autofocus></fieldset><fieldset><label class="label">新密码</label><input name="password" type="password" required></fieldset><fieldset><label class="label">确认新密码</label><input name="password2" type="password" required></fieldset><fieldset><button type="submit">更改密码</button></fieldset></form>',handler:"/api/user/[uid]?action=put",vars:{uid:cache.get("uid")},success:function(y){if(validateResponse(y)){return"密码更改成功。"}}},sendPM:{html:'<form accept-charset="UTF-8" autocomplete="off" method="post"><fieldset><label class="label">收信人</label><a href="/app/user/profile/[uid]">[username]</a><input name="toUID" type="hidden" value="[uid]"></fieldset><fieldset><label class="label">短信正文</label><textarea name="body" required autofocus></textarea></fieldset><fieldset><button type="submit">发送短信</button></fieldset></form>',handler:"/api/message",success:function(y){if(validateResponse(y)){return"短信发送成功。"}}}};var h=$("div#popupbox"),d=$("div#messagebox"),v=$('<div id="overlay"></div>'),r=false;v.click(function(){v.detach();h.hide();r=false});var n=function(){h.css("left",p.scrollLeft()+Math.max((p.width()-h.outerWidth())/2,0));h.css("top",p.scrollTop()+Math.max((p.height()-h.outerHeight())/2,0))};$("a.popup").click(function(F){F.preventDefault();var D=$(this);var A=D.attr("href").substr(1);if(A in g){if(!jQuery.contains(document,v[0])){v.insertBefore(h)}var z=g[A].html;var B=g[A].handler;var E={};if("vars" in g[A]){E=$.extend(E,g[A].vars)}if(D.attr("data-vars")){E=$.extend(E,JSON.parse(D.attr("data-vars")))}if(!$.isEmptyObject(E)){for(var y in E){z=z.replace(new RegExp("\\["+y+"\\]","g"),String(E[y]));B=B.replace(new RegExp("\\["+y+"\\]","g"),String(E[y]))}}h.html(z).show(0,n);r=true;$(window).resize(function(){if(r){n()}});var C=$("form",h);C.submit(function(G){G.preventDefault();if(B){$.ajax({method:"POST",url:B,data:C.serialize(),dataType:"json",success:function(I){var H=g[A].success(I);if(H){h.html(H)}},error:function(){alert("错误：提交数据错误")}})}else{alert("错误：无法提交数据")}})}});if(k>0){e()}else{o()}};var c=$.cookie("LZXSID");if(c==null){b(0)}else{if(c!=cache.get("sessionID")){cache.clear();session.clear();$.get("/api/authentication/"+c,function(d){a(d);b(cache.get("uid"))})}else{b(cache.get("uid"))}}});
